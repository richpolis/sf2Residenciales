<?php

namespace Richpolis\BackendBundle\Repository;

use Doctrine\ORM\EntityRepository;
use Richpolis\BackendBundle\Entity\Recurso;

/**
 * RecursoRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class RecursoRepository extends EntityRepository
{
    public function getRecursosPorEdificio($edificio_id,$residencial_id){
        $em=$this->getEntityManager();
        $query=$em->createQuery('
               SELECT i,e,r 
               FROM BackendBundle:Recurso i 
               JOIN i.edificios e 
               JOIN e.residencial r 
               WHERE (e.id = :edificio AND i.tipoAcceso<=:publico) 
               AND r.id = :residencial 
               ORDER BY i.nombre ASC
        ')->setParameters(array(
            'edificio'=> $edificio_id,
            'publico'=>Recurso::TIPO_ACCESO_EDIFICIO,
            'residencial'=>$residencial_id
        ));
        return $query->getResult();
    }
}
